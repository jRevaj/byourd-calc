<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Byourd Investment Calculator</title>
    <style>
        .tooltip {
            position: relative;
            opacity: 1;
            padding: 0;
        }
        .tooltip .tooltiptext {
            display: none;
            width: 50rem;
            background-color: rgb(55, 74, 88);
            color: rgb(227, 231, 234);
            text-align: center;
            font-size: 1.6rem;
            border-radius: .6rem;
            padding: 1rem;
            position: absolute;
            z-index: 1;
            top: 150%;
            left: 50%;
            margin-left: -25rem;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent rgb(55, 74, 88) transparent;
        }
        .tooltip:hover .tooltiptext {
            display: block;
        }
    </style>
</head>
<body>
    <form id="form" action="index.html">
        <label for="rp" class="rplabel"></label>
        <input type="number" name="rozloha-pozemku" id="rp" class="rp" min="23000" step="100" required placeholder="Rozloha pozemku v m²" ><br><br>
        <label for="stat"></label>
        <select onchange="changeLocationList()" id="stat" class="selct">
            <option value="" selected disabled>Vyber štát</option>
            <option value="svk">Slovensko</option>
            <option value="cz">Ceska Republika</option>
            <!-- <option value="at">Rakusko</option> -->
        </select><br><br>
        <label for="lp"></label>
        <select id="lp" class="selct">
            <option value="" selected disabled>Vyber lokalitu </option>
        </select><br><br>
        <input type="button" onclick="kalkulacia()" value="Vypočítaj" class="btn">
    </form>

    <p>Náklady na pozemok: <span class="tooltip"><span class="tooltiptext">* Náklady na pozemok sú vypočítané na základe priemernej ceny za m2 v danej lokalite uvádzané na portáloch nehnutelnosti.sk a reality.idnes.cz ku dňu 22.3.2020</span><span class="res" id="naklady"></span></span></p>
    <p>Počet viladomov na pozemku bude: <span class="res" id="pViladomov"></span><span class="res" id="pvmax"></span></p>
    <p>Celkové náklady projektu v danej lokalite: <span class="res" id="cnpNaLokalitu"></span></p>
    <p>Celkové výnosy projektu: <span class="tooltip"><span class="tooltiptext">* Priemerné predajné ceny sú vypočítané na základe priemernej ceny za m2 v danej lokalite uvádzané na portáloch nehnutelnosti.sk a reality.idnes.cz ku dňu 22.3.2020.</span><span class="res" id="vynosy"></span></span></p>
    <p>Hrubý zisk: <span class="res" id="hz"></span></p>
    <p>Čistý zisk: <span class="res" id="cz"></span></p>


    <p>struktura financovania a vsetky dolezite financne ukazovatele</p>
    <form id="form1" action="">
        <input type="email" name="user-email" id="mail" placeholder="Zadajte vas email"><br>
        <input type="button" onclick="kalkulaciaPoZadaniMailu()" value="chcem vediet viac!">
    </form>

    <p id="pozemok"></p>
    <p id="investicia"></p>
    <p id="rev"></p>
    <p id="cudzieZdroje"></p>
    <p id="roi"></p>
    <p id="roe"></p>
    <p id="dobaNavratnosti"></p>
    <p id="npv"></p>
    <p id="irr"></p>
    <script>
        // DB -----------------------------------------------------
        // db hodnot pre lokality
        let db = {};
        db['svk'] = [
            {
                id: '0',
                name: 'Bratislava',
                avgprice: 2399.99,
                plotprice: 150,
            },
            {
                id: '1',
                name: 'Trnava',
                avgprice: 1739.20,
                plotprice: 70,
            },
            {
                id: '2',
                name: 'Nitra',
                avgprice: 1604.80,
                plotprice: 76,
            },
            {
                id: '3',
                name: 'Kosice',
                avgprice: 1634.74,
                plotprice: 120,
            },
            {
                id: '4',
                name: 'Trencin',
                avgprice: 1456,
                plotprice: 60,
            },
            {
                id: '5',
                name: 'Piestany',
                avgprice: 1584,
                plotprice: 68,
            },
            {
                id: '6',
                name: 'Presov',
                avgprice: 1356.80,
                plotprice: 28,
            },
            {
                id: '7',
                name: 'Vysoke Tatry',
                avgprice: 1584,
                plotprice: 65,
            },
            {
                id: '8',
                name: 'Poprad',
                avgprice: 1640,
                plotprice: 68,
            },
            {
                id: '9',
                name: 'Banska Bystrica',
                avgprice: 1720,
                plotprice: 39,
            },
            {
                id: '10',
                name: 'Zvolen',
                avgprice: 1584,
                plotprice: 35,
            },
            {
                id: '11',
                name: 'Zilina',
                avgprice: 1550.94,
                plotprice: 31.23,
            },
            {
                id: '12',
                name: 'Liptovsky Mikulas',
                avgprice: 1468.97,
                plotprice: 55,
            }]
        db['cz'] = [
            {
                id: '0',
                name: 'Karlove Vary',
                avgprice: 1381.7818,
                plotprice: 48.10,
            },
            {
                id: '1',
                name: 'Cheb',
                avgprice: 1934.7449,
                plotprice: 84.36,
            },
            {
                id: '2',
                name: 'Liberec',
                avgprice: 1666.1100,
                plotprice: 73.26,
            },
            {
                id: '3',
                name: 'Hradec Kralove',
                avgprice: 1907.3814,
                plotprice: 79.92,
            },
            {
                id: '4',
                name: 'Kladno',
                avgprice: 1960.4775,
                plotprice: 66.60,
            },
            {
                id: '5',
                name: 'Mlada Boleslav',
                avgprice: 1525.7451,
                plotprice: 44.40,
            },
            {
                id: '6',
                name: 'Praha okolie',
                avgprice: 2731.9611,
                plotprice: 203.50,
            },
            {
                id: '7',
                name: 'Plzen',
                avgprice: 1587.8435,
                plotprice: 46.25,
            },
            {
                id: '8',
                name: 'Ceske Budejovice',
                avgprice: 1357.1071,
                plotprice: 32.56,
            },
            {
                id: '9',
                name: 'Jihlava',
                avgprice: 1433.3942,
                plotprice: 29,
            },
            {
                id: '10',
                name: 'Pardubice',
                avgprice: 1612.8696,
                plotprice: 29.60,
            },
            {
                id: '11',
                name: 'Brno',
                avgprice: 1838.0220,
                plotprice: 118.40,
            },
            {
                id: '12',
                name: 'Breclav',
                avgprice: 1727.7472,
                plotprice: 46.95,
            },
            {
                id: '13',
                name: 'Zlin',
                avgprice: 1737.3807,
                plotprice: 66.60,
            },
            {
                id: '14',
                name: 'Uherske Hradiste',
                avgprice: 1492.60,
                plotprice: 62.90,
            },
            {
                id: '15',
                name: 'Olomouc',
                avgprice: 1469.2142,
                plotprice: 64.31,
            },
            {
                id: '16',
                name: 'Ostrava',
                avgprice: 1789.6635,
                plotprice: 111,
            }]
        // pomocna db pre vyber lokality
        let stateAndLoc = {};
        stateAndLoc['svk'] = ['Bratislava', "Trnava", 'Nitra', 'Kosice', 'Trencin', 'Piestany', 'Presov', 'Vysoke Tatry', 'Poprad', 'Zvolen', 'Banska Bystrica', 'Zilina', 'Liptovsky Mikulas'];
        stateAndLoc['cz'] = ['Karlove Vary', 'Cheb', 'Liberec', 'Hradec Kralove', 'Kladno', 'Mlada Boleslav', 'Praha okolie', 'Plzen', 'Ceske Budejovice', 'Jihlava', 'Pardubice', 'Brno', 'Breclav', 'Zlin', 'Uherske Hradiste', 'Olomouc', 'Ostrava'];

        // VSTUPNE UDAJE NA VYPOCET ---------------------------------------------------
        //rozloha jedneho viladomu
        const rjd = 2332;
        //rozloha parkovacieho miesta
        const rpm = 14;
        //cena parkovacieho miesta
        const cpm = 5900;
        //predajna plocha 1 viladomu
        const ppjv = 1591;
        //naklady na 1 viladom
        const njd = 1776448.94;

        // POMOCNE PREMENNE ------------------------------------------------------------
        let rp, currentVal;
        let stateList, locationList, selState;
        let selOpt, plot, result, resultPVNP, resultCVP, resultPPM, resultCNPDL, resultHZ, resultCZ;
        let inv, rv, cudzieZdroje, roi, roe, dn, npv, irr;

        // pomocné premenné pre pomocné výpočty
        let kv1, kv2, kv3, kv4;
        let kp1, kp2, kp3, kp4;
        let cth1, cth2, cth3, cth4;
        let df1, df2, df3, df4;
        let dct1, dct2 ,dct3, dct4;
        let kdt1, kdt2, kdt3, kdt4;
        let CArray, irrC, min, max, NPVt;
        // ZMENA LOKALIT PODLA VYBERU STATU ----------------------------------------------------
        // func pre zmenu lokalit podla statu
        function changeLocationList() {
            // oznacenie elementov
            stateList = document.getElementById("stat");
            locationList = document.getElementById("lp");

            //zbieranie hodnot
            selState = stateList.options[stateList.selectedIndex].value;

            // vymazanie uz nacitanych hodnot
            while (locationList.options.length) {
                locationList.remove(0);
            }

            // nacitanie hodnot zo zoznamu po zvoleni statu
            let states = stateAndLoc[selState];
            if (states) {
                var i;
                for (i = 0; i < states.length; i++) {
                    var state = new Option(states[i], i);
                    locationList.options.add(state);
                }
            }
        }

        // VYPOCTY -----------------------------------------------------------------------
        // main func
        function kalkulacia() {
            // oznacenie elementov
            stateList = document.getElementById("stat");
            locationList = document.getElementById("lp");
            rp = document.getElementById("rp");

            //zbieranie hodnot
            selState = stateList.options[stateList.selectedIndex].value;
            selOpt = locationList.options[locationList.selectedIndex].value;
            currentVal = rp.value;

            // nájdenie hodnôt v db
            plot = db[selState].find( ({ id }) => id === selOpt);

            // naklady na pozemok
            result = currentVal * plot.plotprice;

            // pocet vila domov
            resultPVNP = currentVal / rjd;
            resultPVNP = Math.floor(resultPVNP);
            if (resultPVNP > 24) {
                document.getElementById("pViladomov").innerHTML = "24";
                document.getElementById("pvmax").innerHTML = "Maximálny počet viladomov na pozemku je 24.<br>Zvyšok pozemku sa použije na ďalší produkt od ByourD.";
            } else {
                document.getElementById("pViladomov").innerHTML = resultPVNP;
            }


            // pocet parkovacich miest
            resultPPM = resultPVNP * 18;
            resultPPM = Math.floor(resultPPM);

            // celkove naklady projektu v danej lokalite
            resultCNPDL = resultPVNP * njd + result;

            // celkove vynosy projektu
            resultCVP = resultPVNP * ppjv * plot.avgprice + (resultPPM * cpm);

            // hruby zisk
            resultHZ = resultCVP - resultCNPDL;

            // cisty zisk
            resultCZ = resultHZ - (resultHZ * 0.21);

            // zaokruhlenie na 2 desatine miesta
            result = Math.round((result + Number.EPSILON) * 100) / 100;
            resultCNPDL = Math.round((resultCNPDL + Number.EPSILON) * 100) / 100;
            resultCVP = Math.round((resultCVP + Number.EPSILON) * 100) / 100;
            resultHZ = Math.round((resultHZ + Number.EPSILON) * 100) / 100;
            resultCZ = Math.round((resultCZ + Number.EPSILON) * 100) / 100;

            // vypisanie vysledkov
            document.getElementById("naklady").innerHTML = result.toLocaleString() + "€*";
            //document.getElementById("pViladomov").innerHTML = resultPVNP;
            //document.getElementById("pParkMiest").innerHTML = resultPPM;
            document.getElementById("cnpNaLokalitu").innerHTML = resultCNPDL.toLocaleString() + "€";
            document.getElementById("vynosy").innerHTML = resultCVP.toLocaleString() + "€*";
            document.getElementById("hz").innerHTML = resultHZ.toLocaleString() + "€";
            document.getElementById("cz").innerHTML = resultCZ.toLocaleString() + "€";
        }

        // UDAJE ZOBRAZENE PO ZADANI MAILU -----------------------------------------------
        function kalkulaciaPoZadaniMailu() {
            // POMOCNE VYPOCTY NA KAZDY ROK TRVANIA PROJEKTU
            // kapitalove vydavky
            kv1 = resultCNPDL * 0.23;
            kv2 = resultCNPDL * 0.56;
            kv3 = resultCNPDL * 0.21;
            kv4 = resultCNPDL * 0;
            // kapitalove prijmy
            kp1 = resultCVP * 0.03;
            kp2 = resultCVP * 0.05;
            kp3 = resultCVP * 0.72;
            kp4 = resultCVP * 0.2;
            // ciste toky hotovosti
            cth1 = kp1 - kv1;
            cth2 = kp2 - kv2;
            cth3 = kp3 - kv3;
            cth4 = kp4 - kv4;
            // diskontny faktor
            df1 = 0.967726326994726;
            df2 = 0.936494243958703;
            df3 = 0.906270134957859;
            df4 = 0.877021468967783;
            // diskontovane ciste toky
            dct1 = cth1 * df1;
            dct2 = cth2 * df2;
            dct3 = cth3 * df3;
            dct4 = cth4 * df4;
            // kumulovane diskontne toky
            kdt1 = dct1;
            kdt2 = dct2 + kdt1;
            kdt3 = dct3 + kdt2;
            kdt4 = dct4 + kdt3;

            // CUDZIE ZDROJE
            cudzieZdroje = resultCNPDL * 0.75;


            // INVESTICIA
            inv = (resultCNPDL - cudzieZdroje - result) * 0.55;

            // REINVESTOVANIE VYNOSOV
            rv = (resultCNPDL - cudzieZdroje - result) * 0.45;

            // ROI
            roi = resultCZ / (result + inv + cudzieZdroje);


            // ROE
            roe = (resultCZ - result - inv) / (result + inv);


            // DOBA NAVRATNOSTI
            dn = 3 + (kdt3 / -kdt4);


            // NPV
            npv = dct1 + dct2 + dct3 + dct4;


            // IRR
            // pomocna funkcia
            CArray = [cth1, cth2, cth3, cth4];

            function IRRCalc() {
                min = 0.0;
                max = 1.0;
                do {
                    irrC = (min + max) / 2;
                    NPVt = 0;
                    for (var j=0; j<CArray.length; j++) {
                        NPVt += CArray[j]/Math.pow((1+irrC),j);
                    }
                    if (NPVt > 0) {
                        min = irrC;
                    }
                    else {
                        max = irrC;
                    }
                } while(Math.abs(NPVt) > 0.000001);
                return irrC * 100;
            }
            // vysledok pomocnej funkcie
            irr = IRRCalc();

            // ZAOKRUHLENIE
            cudzieZdroje = Math.round((cudzieZdroje + Number.EPSILON) * 100) / 100;
            inv = Math.round((inv + Number.EPSILON) * 100) / 100;
            rv = Math.round((rv + Number.EPSILON) * 100) / 100;
            roi = Math.round((roi + Number.EPSILON) * 10000) / 100;
            roe = Math.round((roe + Number.EPSILON) * 10000) / 100;
            dn = Math.round((dn + Number.EPSILON) * 100) / 100;
            npv = Math.round((npv + Number.EPSILON) * 100) / 100;
            irr = Math.round((irr + Number.EPSILON) * 100) / 100;

            // ZOBRAZENIE
            document.getElementById("pozemok").innerHTML = result.toLocaleString() + "€";
            document.getElementById("cudzieZdroje").innerHTML = cudzieZdroje.toLocaleString() + "€";
            document.getElementById("investicia").innerHTML = inv.toLocaleString() + "€";
            document.getElementById("rev").innerHTML = rv.toLocaleString() + "€";
            document.getElementById("roi").innerHTML = roi + "%";
            document.getElementById("roe").innerHTML = roe + "%";
            document.getElementById("dobaNavratnosti").innerHTML = dn;
            document.getElementById("npv").innerHTML = npv.toLocaleString() + "€";
            document.getElementById("irr").innerHTML = irr + "%";
        }
    </script>
</body>
</html>